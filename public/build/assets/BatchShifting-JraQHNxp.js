import{r as a,j as e}from"./app-CEKwIvuo.js";import{A as P}from"./AdminLayout-CPbZClx0.js";import{a as u}from"./axiosInstance-CpK50YgK.js";import{u as R}from"./adminContext-B4ZH0dBI.js";import{V as n}from"./index-CDLh0U6I.js";import"./menu-ClYTqC9x.js";import"./createLucideIcon-Bjxz-2FJ.js";import"./search-Ba20Hc8C.js";import"./bell-Ds8nJPYB.js";import"./user-Dye2o9pv.js";import"./x-CndvnG7B.js";import"./house-DBqdGzGq.js";import"./users-vopEeiFR.js";import"./settings-BNAerSY-.js";import"./log-out-BKbNxByv.js";const q=()=>{const{admin:i}=R(),l=i==null?void 0:i.id,[A,x]=a.useState(!1),[b,S]=a.useState(""),[F,O]=a.useState([]),[p,j]=a.useState(""),[w,f]=a.useState([]),[c,N]=a.useState([]),[y,v]=a.useState(!1),[o,B]=a.useState(""),[U,D]=a.useState([]),[h,g]=a.useState(""),[C,k]=a.useState([]),[I,_]=a.useState(!1),L=async(s,t)=>{if(!(!s||!l))try{const r=await u.get(`/admin/${l}/batches?session=${s}`);t(r.data||[])}catch{n.error("Failed to fetch batches for session")}},V=async()=>{var s;if(!p||!b){n.error("Select batch and session first");return}v(!0);try{const t=await u.get(`/admin/batches/shift/${l}/${p}/${b}`);f(((s=t.data)==null?void 0:s.data)||[]),N([])}catch{n.error("Failed to fetch students"),f([])}finally{v(!1)}},z=s=>{N(t=>t.includes(s)?t.filter(r=>r!==s):[...t,s])},$=a.useMemo(()=>c.length>0&&h&&o,[c,h,o]),M=async()=>{var s,t,r;if(!$){n.error("Pick students and fill new batch & session");return}try{const d=await u.post("/admin/batches/shift",{admin_id:l,student_ids:c,batch_id:Number(h),session:o});n.success(((s=d.data)==null?void 0:s.message)||"Batch updated successfully"),x(!1),f([]),N([]),S(""),j(""),B(""),g(""),E()}catch(d){const m=((r=(t=d==null?void 0:d.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to update batch";n.error(m)}},E=async()=>{if(l)try{_(!0);const s=await u.get(`/admin/${l}/batch-shift-logs`);k(s.data||[])}catch{n.error("Failed to fetch batch shift history"),k([])}finally{_(!1)}};return a.useEffect(()=>{l&&E()},[l]),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Batch Shifting"}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",onClick:()=>x(!0),children:"Update Batch Shifting"}),A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex justify-end z-50",children:e.jsxs("div",{className:"bg-white w-full md:w-1/2 p-6 overflow-auto",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Update Batch Shifting"}),e.jsx("button",{className:"text-red-600 mb-4",onClick:()=>x(!1),children:"Close"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Current Session"}),e.jsx("input",{type:"text",className:"border p-2 rounded w-full",placeholder:"e.g. 2024-25",value:b,onChange:s=>{S(s.target.value),j(""),L(s.target.value,O)}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Current Batch"}),e.jsxs("select",{className:"border p-2 rounded w-full",value:p,onChange:s=>j(s.target.value),children:[e.jsx("option",{value:"",children:"-- Select --"}),F.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.id,")"]},s.id))]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:V,className:"bg-blue-600 text-white px-4 py-2 rounded w-full",disabled:y,children:y?"Loading...":"Load Students"})})]}),w.length>0&&e.jsxs("div",{className:"mb-4 border rounded p-3",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Select Students"}),e.jsx("div",{className:"overflow-auto max-h-64",children:e.jsxs("table",{className:"min-w-full border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Select"}),e.jsx("th",{className:"p-2 border",children:"Enroll #"}),e.jsx("th",{className:"p-2 border",children:"Name"})]})}),e.jsx("tbody",{children:w.map(s=>e.jsxs("tr",{className:"odd:bg-white even:bg-gray-50",children:[e.jsx("td",{className:"p-2 border text-center",children:e.jsx("input",{type:"checkbox",checked:c.includes(s.id),onChange:()=>z(s.id)})}),e.jsx("td",{className:"p-2 border",children:s.enrollment_number}),e.jsx("td",{className:"p-2 border",children:s.name})]},s.id))})]})})]}),c.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"New Session"}),e.jsx("input",{type:"text",className:"border p-2 rounded w-full",placeholder:"e.g. 2025-26",value:o,onChange:s=>{B(s.target.value),g(""),L(s.target.value,D)}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"New Batch"}),e.jsxs("select",{className:"border p-2 rounded w-full",value:h,onChange:s=>g(s.target.value),children:[e.jsx("option",{value:"",children:"-- Select --"}),U.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.id,")"]},s.id))]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:M,className:"bg-green-600 text-white px-4 py-2 rounded w-full",disabled:!$,children:["Update Batch (",c.length,")"]})})]})]})}),e.jsxs("div",{className:"border p-3 rounded",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Batch Shift History"}),I?e.jsx("p",{children:"Loading history..."}):C.length===0?e.jsx("p",{children:"No batch shift history found."}):e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"min-w-full border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Enrollment No."}),e.jsx("th",{className:"p-2 border",children:"Student"}),e.jsx("th",{className:"p-2 border",children:"Old Batch"}),e.jsx("th",{className:"p-2 border",children:"Old Session"}),e.jsx("th",{className:"p-2 border",children:"New Batch"}),e.jsx("th",{className:"p-2 border",children:"New Session"}),e.jsx("th",{className:"p-2 border",children:"Updated By"}),e.jsx("th",{className:"p-2 border",children:"Date"})]})}),e.jsx("tbody",{children:C.map(s=>{var t,r,d,m,H;return e.jsxs("tr",{className:"odd:bg-white even:bg-gray-50",children:[e.jsx("td",{className:"p-2 border",children:((t=s.student)==null?void 0:t.enrollment_number)||"-"}),e.jsx("td",{className:"p-2 border",children:((r=s.student)==null?void 0:r.name)||"-"}),e.jsx("td",{className:"p-2 border",children:((d=s.oldBatch)==null?void 0:d.name)||s.old_batch_id}),e.jsx("td",{className:"p-2 border",children:s.old_session}),e.jsx("td",{className:"p-2 border",children:((m=s.newBatch)==null?void 0:m.name)||s.new_batch_id}),e.jsx("td",{className:"p-2 border",children:s.new_session}),e.jsx("td",{className:"p-2 border",children:((H=s.admin)==null?void 0:H.name)||"Admin"}),e.jsx("td",{className:"p-2 border",children:new Date(s.created_at).toLocaleString()})]},s.id)})})]})})]})]})};q.layout=i=>e.jsx(P,{children:i});export{q as default};
