import{r as i,j as e}from"./app-CEKwIvuo.js";import{A}from"./AdminLayout-CPbZClx0.js";import{V as s}from"./index-CDLh0U6I.js";import{u as I}from"./adminContext-B4ZH0dBI.js";import{a as m}from"./axiosInstance-CpK50YgK.js";import{L as $}from"./Loader-BSxm8PVY.js";import{P as E}from"./plus-BwwImoXL.js";import{P as L}from"./pencil-BAvq_tfo.js";import{T as D}from"./trash-ByDCIRi9.js";import"./menu-ClYTqC9x.js";import"./createLucideIcon-Bjxz-2FJ.js";import"./search-Ba20Hc8C.js";import"./bell-Ds8nJPYB.js";import"./user-Dye2o9pv.js";import"./x-CndvnG7B.js";import"./house-DBqdGzGq.js";import"./users-vopEeiFR.js";import"./settings-BNAerSY-.js";import"./log-out-BKbNxByv.js";import"./loader-circle-BsKjsRXP.js";function F(){const{admin:o}=I(),[c,y]=i.useState([]),[a,f]=i.useState({roomName:"",roomType:""}),[x,b]=i.useState(null),[N,v]=i.useState(""),[k,h]=i.useState(!1),[n,d]=i.useState(!1);i.useEffect(()=>{async function r(){try{if(!(o!=null&&o.id))return;d(!0);const t=await m.get(`/admin/${o.id}/class-rooms`);y(t.data.rooms||[])}catch(t){s.error("Failed to fetch rooms"),console.error(t)}finally{d(!1)}}r()},[o==null?void 0:o.id]);const j=r=>f({...a,[r.target.name]:r.target.value}),g=()=>{f({roomName:"",roomType:""}),b(null)},C=async r=>{var p;r.preventDefault();const t=o==null?void 0:o.id;if(!t){s.error("Admin not found. Please login again.");return}if(!a.roomName.trim()){s.error("Room name is required");return}if(!a.roomType.trim()){s.error("Room type is required");return}if(isNaN(a.roomType)){s.error("Room type must be a number");return}const u={roomName:a.roomName,roomType:Number(a.roomType)};try{if(d(!0),x!==null){const R=(p=c[x])==null?void 0:p.id;if(!R)throw new Error("Room ID missing for update");await m.put(`/admin/${t}/class-room/${R}`,u),s.success("Room updated")}else await m.post(`/admin/${t}/class-room`,u),s.success("Room added");const l=await m.get(`/admin/${t}/class-rooms`);y(l.data.rooms||[]),g(),h(!1)}catch(l){s.error("Failed to save room"),console.error(l)}finally{d(!1)}},T=r=>{f({roomName:c[r].room_name,roomType:c[r].room_type.toString()}),b(r),h(!0)},S=async r=>{var p;if(!window.confirm("Are you sure you want to delete this room?"))return;const t=o==null?void 0:o.id,u=(p=c[r])==null?void 0:p.id;if(!u||!t){s.error("Room or Admin ID missing");return}try{d(!0),await m.delete(`/admin/${t}/class-room/${u}`),s.success("Room deleted");const l=await m.get(`/admin/${t}/class-rooms`);y(l.data.rooms||[])}catch(l){s.error("Failed to delete room"),console.error(l)}finally{d(!1)}},w=c.filter(r=>r.room_name.toLowerCase().includes(N.toLowerCase()));return e.jsxs("div",{className:"p-6 bg-white dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Control Room"}),e.jsxs("button",{onClick:()=>{g(),h(!0)},className:"bg-indigo-600 text-white px-4 py-2 rounded flex items-center gap-2 hover:bg-indigo-700",disabled:n,children:[e.jsx(E,{className:"w-4 h-4"}),"Add Room"]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search room by name",value:N,onChange:r=>v(r.target.value),className:"px-4 py-2 border rounded w-full md:w-1/3 dark:bg-gray-800 dark:text-white",disabled:n})}),n?e.jsx($,{message:"Loading rooms..."}):e.jsx("div",{className:"overflow-x-auto rounded-lg shadow bg-white dark:bg-gray-800",children:e.jsxs("table",{className:"min-w-full text-sm text-left text-gray-900 dark:text-white",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700 text-xs uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Room Name"}),e.jsx("th",{className:"px-4 py-2",children:"Room Type"}),e.jsx("th",{className:"px-4 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:w.length>0?w.map((r,t)=>e.jsxs("tr",{className:"border-b dark:border-gray-600",children:[e.jsx("td",{className:"px-4 py-2",children:r.room_name}),e.jsx("td",{className:"px-4 py-2",children:r.room_type}),e.jsxs("td",{className:"px-4 py-2 flex gap-2",children:[e.jsxs("button",{onClick:()=>T(t),className:"text-yellow-600 hover:underline",disabled:n,children:[e.jsx(L,{className:"w-4 h-4 inline"})," Edit"]}),e.jsxs("button",{onClick:()=>S(t),className:"text-red-600 hover:underline",disabled:n,children:[e.jsx(D,{className:"w-4 h-4 inline"})," Delete"]})]})]},r.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"px-4 py-4 text-center text-gray-500 dark:text-gray-400",children:"No rooms found."})})})]})}),e.jsxs("div",{className:`fixed top-0 right-0 w-full sm:w-[400px] h-full bg-white dark:bg-gray-900 z-50 shadow-lg transition-transform duration-300 ${k?"translate-x-0":"translate-x-full"}`,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-bold",children:x!==null?"Edit Room":"Add Room"}),e.jsx("button",{onClick:()=>{h(!1),g()},className:"text-gray-600 dark:text-gray-300 hover:text-red-600",children:"âœ•"})]}),e.jsxs("form",{onSubmit:C,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{children:"Room Name"}),e.jsx("input",{type:"text",name:"roomName",value:a.roomName,onChange:j,required:!0,className:"w-full px-4 py-2 border rounded dark:bg-gray-800 dark:text-white",disabled:n})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Room Type (Number)"}),e.jsx("input",{type:"number",name:"roomType",value:a.roomType,onChange:j,required:!0,className:"w-full px-4 py-2 border rounded dark:bg-gray-800 dark:text-white",disabled:n})]}),e.jsx("button",{type:"submit",className:"w-full bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700",disabled:n,children:x!==null?"Update Room":"Add Room"})]})]})]})}F.layout=o=>e.jsx(A,{children:o});export{F as default};
